<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: commonHead('Corrispondenza – Veely')}"></head>
<body class="d-flex flex-column min-vh-100">
<div th:insert="~{fragments/navbar :: mainNavbar}"></div>
<main class="container my-5 flex-fill">
    <h2 class="fw-semibold mb-3">Corrispondenza</h2>
    <form class="row g-2 mb-4" method="post" th:action="@{/correspondence}">
        <div class="col-auto">
            <select name="tipo" class="form-select" required>
                <option th:each="t : ${types}" th:value="${t}" th:text="${t.label}"></option>
            </select>
        </div>
        <div class="col-auto">
            <input type="text" name="descrizione" class="form-control" placeholder="Oggetto" required />
        </div>
        <div class="col-auto">
            <input type="text" name="sender" class="form-control" placeholder="Mittente" required />
        </div>
        <div class="col-auto">
            <input type="text" name="recipient" class="form-control" placeholder="Destinatario" />
        </div>
        <div class="col-auto">
            <input type="text" name="notes" class="form-control" placeholder="Note" />
        </div>
        <div class="col-auto">
            <input type="date" name="data" class="form-control" />
        </div>
         <div class="col-auto">
            <input type="file" name="file" class="form-control" />
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Aggiungi</button>
        </div>
    </form>
	
	 <form class="row g-2 mb-4" method="get" th:action="@{/correspondence}">
        <div class="col-auto">
            <input type="text" name="keyword" class="form-control" placeholder="Cerca…" th:value="${keyword}" />
        </div>
        <div class="col-auto">
            <input type="number" name="year" class="form-control" th:value="${year}" />
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-outline-secondary"><i class="bi bi-search"></i></button>
        </div>
    </form>
	
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Protocollo</th>
            <th>Dettagli</th>
            <th>Note/Documento</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="c : ${items}">
             <td>
                <div class="fw-semibold" th:text="${@correspondenceService.formatProtocol(c)}"></div>
                <div class="text-muted small" th:text="${c.data}"></div>
            </td>
            <td>
                <div class="fw-semibold" th:text="${c.descrizione}"></div>
                <div class="text-muted small">
                    <span th:text="${c.sender}"></span>
                    <span th:if="${c.recipient != null}"> → <span th:text="${c.recipient}"></span></span>
                </div>
            </td>
            <td>
                <div th:text="${c.notes}"></div>
                <div th:if="${c.document != null}">
                    <a th:href="@{|/correspondence/docs/${c.document.id}|}">Download</a>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</main>
<div th:insert="~{fragments/footer :: mainFooter}"></div>
</body>
</html>